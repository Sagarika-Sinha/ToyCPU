library IEEE;
use IEEE.STD_LOGIC_1164.ALL;
use IEEE.NUMERIC_STD.ALL;

entity CodeMemory is
    port(
        clk          : in  std_logic;
        c1           : in  std_logic;  -- Write Enable (as in figure)
        write_select : in  std_logic_vector(5 downto 0); -- Write Select (6 bits)
        read_select  : in  std_logic_vector(5 downto 0); -- Read Select (6 bits)
        input_data   : in  std_logic_vector(15 downto 0); -- Input (16 bits)
        output_data  : out std_logic_vector(15 downto 0)  -- Output (16 bits)
    );
end CodeMemory;

architecture Behavioral of CodeMemory is
    -- 64 words of 16 bits
    type mem_array is array (0 to 63) of std_logic_vector(15 downto 0);

    signal memory : mem_array := (
        -- BIOS Code Memory (addresses 0–31)
        0  => "0011001100000000",
        1  => "0111000000000000",
        2  => "1110000100000000",
        3  => "1111001100000000",
        4  => "0001001000000000",
        5  => "0011000100000000",
        6  => "0111010100000000",
        7  => "1010101000000000",
        8  => "1010101100000000",
        9  => "1010110000000000",
        10 => "1010110100000000",
        11 => "1010111000000000",
        12 => "1010111100000000",
        13 => "1011000000000000",
        14 => "1011000100000000",
        15 => "1011001000000000",
        16 => "1011001100000000",
        17 => "1011010000000000",
        18 => "1011010100000000",
        19 => "1011011000000000",
        20 => "1011011100000000",
        21 => "1011100000000000",
        22 => "1011100100000000",
        23 => "1011101000000000",
        24 => "1011101100000000",
        25 => "1011110000000000",
        26 => "1011110100000000",
        27 => "1011111000000000",
        28 => "1011111100000000",
        29 => "1100000000000000",
        30 => "1100000100000000",
        31 => "1100001000000000",

        -- User Code Memory (addresses 32–63) initialized to 0
        others => (others => '0')
    );

begin
    process(clk)
    begin
        if rising_edge(clk) then
            -- Write is allowed only to user region (32–63)
            if (c1 = '1') and (to_integer(unsigned(write_select)) >= 32) then
                memory(to_integer(unsigned(write_select))) <= input_data;
            end if;
        end if;
    end process;

    -- Read operation (always allowed)
    output_data <= memory(to_integer(unsigned(read_select)));

end Behavioral;
